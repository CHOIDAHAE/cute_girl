<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="UserDAO">
	<select id="comparePw">
		SELECT	EMPLYR_SN, EMPLYR_ID, EMPLYR_PASSWORD, SALT, PASSWORD_ERROR_CO
		FROM	TCM_EMPLYR
		WHERE	EMPLYR_ID = #{id}
	</select>

	<select id="selectUserId">
		SELECT	COUNT(*) CNT
		FROM 	TCM_EMPLYR
		WHERE	EMPLYR_ID = #{id}
	</select>

	<select id="selectemplyrSn">
		SELECT
				TO_CHAR(NVL(MAX(EMPLYR_SN), TO_CHAR(SYSDATE, 'YYYY')||'000000')+1) AS EMPLYR_SN
		FROM 	TCM_EMPLYR
		WHERE	EMPLYR_SN LIKE TO_CHAR(SYSDATE, 'YYYY') ||'%'
	</select>

	<insert id="joinUser">
		INSERT INTO TCM_EMPLYR
			(
				EMPLYR_SN,
				EMPLYR_NM,
				EMPLYR_ID,
				EMPLYR_PASSWORD,
				SALT,
				SEXDSTN_CODE,
				EMAIL_ADRES,
				EMPLYR_MBTLNUM,
				FRST_REGISTER_SN,
				FRST_REGIST_DT,
				LAST_UPDUSR_SN,
				LAST_UPDT_DT
			)VALUES(
				#{emplyrSn},
				#{name},
				#{id},
				#{pw},
				#{salt},
				#{gender},
				#{email},
				#{phoneNo},
				#{emplyrSn},
				SYSDATE,
				#{emplyrSn},
				SYSDATE
			)
	</insert>

	<update id="updatePasswordErrorCo">
		UPDATE
			TCM_EMPLYR
		SET
			PASSWORD_ERROR_CO = PASSWORD_ERROR_CO + 1
		WHERE
			EMPLYR_ID = #{emplyrId}
	</update>
	
	<update id="updateErrorCoInit">
		UPDATE
			TCM_EMPLYR
		SET
			PASSWORD_ERROR_CO 	= 0
		WHERE
			EMPLYR_ID = #{emplyrId}
	</update>

</mapper>