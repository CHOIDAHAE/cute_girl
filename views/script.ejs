<html lang="ko">
    <head>
        <meta charset="utf-8">    
<!--        <link rel="stylesheet" type="text/css" href="/js/common/jquery/jquery-ui.min.css"/>
        <link rel="stylesheet" type="text/css" href="/jqGrid/css/ui.jqgrid.css"/>-->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <script src="https://kit.fontawesome.com/ad41bee873.js" crossorigin="anonymous"></script>
        <link href="../css/style.css?after" rel="stylesheet" type="text/css">
        <link href="../css/menu.css?after" rel="stylesheet" type="text/css">
        <link href="../css/grid.css?after" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" crossorigin="anonymous" />

        <!--<script type="text/javascript" src="/js/common/jquery/jquery-3.2.1.min.js"></script>
        <script src="/jqGrid/js/i18n/grid.locale-kr.js" type="text/javascript"></script>
        <script src="/jqGrid/js/minified/jquery.jqGrid.min.js" type="text/javascript"></script>-->
        <script>
            window.onload = function(){
                file_Volume();
                fileSelect();
            }

            //파일용량 읽어오기
            function file_Volume(){
                var emplyrSn = $('#emplyrSn').val();

                $.ajax({
                    url : "/selectFileVolume",
                    type : "POST",
                    dataType : "JSON", //"JSON"
                    data : {"emplyrSn" : emplyrSn}

                })
                .done(function (res) {
                    $("#capacity").text(res[0]);            // 사용중 용량
                    $("#rest_capacity").text(100-res[0]);   // 남은 용량

                    var bar = document.getElementById('bar');
                    bar.style.width = res[0]+'%';           // graph color control = 남은용량/100
                })
                .fail(function (xhr, textStatus, errorThrown) {
                    console.log('selectFileVolume ajax 실패');
                })
            }
            
            /* 정렬기준 변경 이벤트 */
            function selectNayeol(){
                var sortSelect = document.getElementById("sortSbBox");
                var selectValue = sortSelect.options[sortSelect.selectedIndex].value;
                var selectText = sortSelect.options[sortSelect.selectedIndex].text;
                var ibx_boonmoon = document.getElementById("main");

                ibx_boonmoon.textContent = selectText;
                
            }

            function openMenu(menuNm){
                var gridArea = document.getElementById("gridArea");
                
                console.log(gridArea);
                console.log(menuNm);                

                document.getElementById("gridArea").src = menuNm;
            }
            
            //파일 선택시 사이드바 정보 띄우는 이벤트
            function view_photoInfo(){
                var fileInfoArea = $('#gridArea').contents().find('#file_type')

                $('#gridArea').contents().find('#file_type').textContent = "종류 클릭";

                var sideInfo_box = document.getElementById("sideInfo_box");
                var sideEle1 = document.querySelector("#file_click");
                var sideEle2 = document.querySelector("#file_nonClick");


                //sideInfo_box.textContent = "사진을 선택하였습니다.";

                sideEle1.classList.toggle("sideInfoClick");
                sideEle2.classList.toggle("sideInfoClick");
            }

            // 대메뉴, 소메뉴 선택시 클래스 삭제
            function unselected(gbn){
                /* 
                 * 대메뉴 id 명명규칙 : dMenu0, dMenu1..
                 * 소메뉴 id 명명규칙 : sMenu00, sMenu01 (대메뉴 dMenu0아래의 소메뉴) / sMenu10, sMenu11 (대메뉴 dMenu1아래의 소메뉴)
                */
                // 하드코딩, 메뉴 코드관리?
                for( var i=0; i<4; i++){    //대메뉴 4개
                        document.getElementById('dMenu'+i).classList.remove('selected');
                    }

                for( var i=0; i<4; i++){    //소메뉴(모든파일) 4개
                    document.getElementById('sMenu0'+i).classList.remove('selected');
                }

                for( var i=0; i<1; i++){    //소메뉴(내 그룹) 2개
                    document.getElementById('sMenu3'+i).classList.remove('selected');
                }
            };

            // 대메뉴, 소메뉴 선택시 클래스 추가
            function selected(menuId){
                document.getElementById(menuId).classList.add('selected');
            }

            /* 파일 업로드 */
            function fileUpload(){
                console.log('file upload!');
                const formData = new FormData();
                formData.append('file', $('#fileUpload')[0].files[0]);

                $.ajax({
                    type:"POST",
                    processData : false,
                    contentType : false,
                    enctype: 'multipart/form-data',
                    url : '/uploadFile',
                    data : formData,
                    success:function(r){
                        console.log('file success');
                    },
                    error:function(){
                        console.log('fileUpload ajax error');
                    }
                })
            }

            // 파일 조회 
            function fileSelect(){
                var emplyrSn = document.getElementById('emplyrSn').value;

                $.ajax({
                    url : "/selectFileList",
                    type : "POST",
                    dataType : "JSON", //"JSON"
                    data : {"emplyrSn" : emplyrSn}

                })
                .done(function (res) {
                    var fileArea = $('#gridArea').contents().find('#fileList');
                    
                    var fileList = "";

                    for(var i=0; i<res.length; i++){
                        // $('#fileList').append('<li><img src="./uploadedFiles/' + res[i][2] + '" class="img_item" onclick="view_photoInfo()"><div class="item-name"> ' + res[i][1] + ' </div></li>');
                        fileList += '<li class="item_fnc" id="' + res[i][8] + '_' + res[i][9] + '" ondblclick="view_photoInfo(this)"><img src="./uploadedFiles/' + res[i][2] + '" class="img_item">\n';
                        fileList += '<input type="hidden" id="fileType' + [i] + ' value=' + res[i][3] + '>';
                        fileList += '<input type="hidden" id="fileLocation' + [i] + '" value=' + res[i][0] + '>';
                        fileList += '<input type="hidden" id="fileSize' + [i] + '" value=' + res[i][4] + '>';
                        fileList += '<input type="hidden" id="downNum' + [i] + '" value=' + res[i][5] + '>';
                        fileList += '<input type="hidden" id="frstDt' + [i] + '" value=' + res[i][6] + '>';
                        fileList += '<div class="item-name"> ' + res[i][1] + ' </div></li>\n';
                    }

                    $(fileArea).append(fileList);      //파일 리스트
                })
                .fail(function (xhr, textStatus, errorThrown) {
                    console.log('selectFileList ajax 실패');
                    console.log('xhr'+xhr);
                    console.log('textStatus'+textStatus);
                    console.log('errorThrown'+errorThrown);
                })
            }

            // 환경설정 팝업
            function openWindowPop(url, name){
                var options = 'top=100, left=650, width=800, height=815, status=no, menubar=no, toolbar=no, resizable=no';
                window.open(url, name, options);
            }
        </script>
    </head>